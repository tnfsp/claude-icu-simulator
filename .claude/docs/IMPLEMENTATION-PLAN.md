# ICU Simulator - 實作計畫

> 由 `/pm` 維護

---

## 專案資訊

- **專案名稱**: ICU Simulator
- **PRD 版本**: v0.1
- **計畫建立日期**: 2024-12-14
- **最後更新**: 2024-12-14

---

## 階段規劃

### Phase 1: 專案初始化
> 環境設定、基礎架構

- [ ] **1.1** 初始化 Next.js 專案（App Router）
- [ ] **1.2** 安裝與設定 Tailwind CSS
- [ ] **1.3** 安裝與設定 shadcn/ui
- [ ] **1.4** 安裝 Zustand 狀態管理
- [ ] **1.5** 建立專案目錄結構
- [ ] **1.6** 設定 TypeScript 類型定義（`lib/types.ts`）
- [ ] **1.7** 設定環境變數（`.env.local`）

### Phase 2: 核心 UI 開發
> 前端介面與元件

- [ ] **2.1** 建立主頁面 Layout（左側面板 + 右側互動區）
- [ ] **2.2** VitalSignsPanel 元件（HR, BP, RR, SpO2, Temp）
- [ ] **2.3** StatusPanel 元件（意識狀態、外觀）
- [ ] **2.4** ChatArea 元件（對話歷程顯示）
- [ ] **2.5** ActionPanel 元件（6 個動作按鈕）
- [ ] **2.6** 建立 Zustand store（遊戲狀態管理）

### Phase 3: 互動功能 - 基礎
> 選單式互動功能

- [ ] **3.1** PhysicalExamModal（理學檢查選單 + 結果顯示）
- [ ] **3.2** LabOrderModal（檢驗開立勾選）
- [ ] **3.3** LabResultsModal（檢驗報告顯示，台灣格式）
- [ ] **3.4** POCUSModal（選擇 view + 顯示圖片/影片）
- [ ] **3.5** OrdersModal（醫囑開立：藥物 + 劑量 + 頻次）
- [ ] **3.6** 醫囑劑量驗證邏輯（`lib/validators.ts`）

### Phase 4: 互動功能 - AI 對話
> Claude API 整合

- [ ] **4.1** 建立 `/api/chat` API Route
- [ ] **4.2** Claude API 封裝（`lib/claude.ts`）
- [ ] **4.3** 對話輸入元件整合
- [ ] **4.4** Streaming 回應實作
- [ ] **4.5** 對話歷程 context 管理

### Phase 5: 情境系統
> 情境載入與 Debrief

- [ ] **5.1** 建立首個情境 JSON（Cardiogenic shock）
- [ ] **5.2** 建立 `/api/scenario` API Route
- [ ] **5.3** 情境載入與初始化邏輯
- [ ] **5.4** DiagnosisModal（提交診斷選擇）
- [ ] **5.5** DebriefModal（結果分析、最佳路徑）
- [ ] **5.6** 操作追蹤（記錄學員做了什麼）

### Phase 6: 整合與測試
> 完整流程測試

- [ ] **6.1** 完整流程走通測試
- [ ] **6.2** UI/UX 調整與優化
- [ ] **6.3** 響應式設計調整（平板支援）
- [ ] **6.4** 錯誤處理與 loading 狀態

### Phase 7: 部署
> Vercel 部署上線

- [ ] **7.1** 環境變數設定（Vercel）
- [ ] **7.2** 部署測試
- [ ] **7.3** 域名設定（如需要）

---

## Subagent 分配

| Subagent | 職責 | 負責任務 | 狀態 |
|----------|------|----------|------|
| `/coder` | 全端開發 | Phase 1-6 全部開發工作 | 待建立 |
| `/scenario` | 情境設計 | Phase 5.1 情境 JSON | 待建立 |

### Subagent 說明

**為什麼只用 `/coder` 而不分 frontend/backend？**
- Next.js 是全端框架，前後端界線模糊
- 專案規模適中，一個 coder 可以處理
- 減少 subagent 間協調成本

**`/scenario` 的必要性：**
- 情境設計需要醫學專業知識
- 與程式開發分離，方便未來擴充情境
- 用戶可能需要協助撰寫情境資料

---

## 進度追蹤

| 階段 | 狀態 | 完成度 | 預估任務數 |
|------|------|--------|------------|
| Phase 1 | 未開始 | 0% | 7 項 |
| Phase 2 | 未開始 | 0% | 6 項 |
| Phase 3 | 未開始 | 0% | 6 項 |
| Phase 4 | 未開始 | 0% | 5 項 |
| Phase 5 | 未開始 | 0% | 6 項 |
| Phase 6 | 未開始 | 0% | 4 項 |
| Phase 7 | 未開始 | 0% | 3 項 |
| **總計** | - | 0% | **37 項** |

---

## 依賴關係

```
Phase 1 (初始化)
    ↓
Phase 2 (UI) ←───────────────┐
    ↓                        │
Phase 3 (基礎互動)            │
    ↓                        │
Phase 4 (AI 對話) ───────────┤
    ↓                        │
Phase 5 (情境) ──────────────┘
    ↓
Phase 6 (整合測試)
    ↓
Phase 7 (部署)
```

**關鍵路徑：** 1 → 2 → 3 → 5 → 6 → 7
**可並行：** Phase 4（AI 對話）可與 Phase 3 並行開發

---

## 風險與注意事項

| 風險 | 影響程度 | 對應策略 |
|------|----------|----------|
| POCUS 素材未備妥 | 中 | 先用 placeholder，素材到位後替換 |
| Claude API 成本超支 | 低 | 使用 Haiku model、設定 max_tokens |
| 醫學內容正確性 | 高 | 請用戶（醫師）審核情境資料 |
| 響應式設計複雜 | 低 | MVP 先專注桌機，平板次之 |

---

## 開發建議

### 給 `/coder` 的指引

1. **優先順序**：先完成能「跑起來」的版本，再優化細節
2. **UI 風格**：參考 PRD 的 Layout 設計，使用 shadcn/ui 元件
3. **狀態管理**：所有遊戲狀態集中在 Zustand store
4. **API 設計**：保持簡單，MVP 不需要複雜的 API

### 給 `/scenario` 的指引

1. **參考範本**：PRD 中已有完整的 scenario.json 範例
2. **醫學準確**：確保 lab 數值、PE findings 符合臨床
3. **素材準備**：POCUS 影片/圖片由用戶提供

---

## 啟動順序建議

1. **現在**：建立 `/coder` subagent
2. **Phase 1 完成後**：開始開發
3. **Phase 3 開始時**：建立 `/scenario` subagent（或 PM 直接協助）
4. **Phase 5**：整合情境資料

---

## 變更記錄

| 日期 | 變更內容 |
|------|----------|
| 2024-12-14 | 初版建立，37 項任務規劃完成 |
